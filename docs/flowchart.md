# CRUD 流程圖 (以「訂購商品」為例)

以下描述使用者在前端發起「訂購商品」操作後，資料在前端、後端和資料庫之間流動的過程：

```mermaid
graph TD
    A[使用者 (前端)] -- 點擊 "立即訂購" --> B(前端應用程式 - React)
    B -- 檢查登入狀態 & 彈出確認視窗 --> C(前端應用程式 - React)
    C -- 發送 POST /api/products/order (帶有 productId, Authorization Token) --> D(後端應用程式 - Node.js/Express)
    D -- 驗證 JWT Token & 檢查使用者權限 (authMiddleware) --> E(後端應用程式 - Node.js/Express)
    E -- 根據 productId 查詢商品資訊 (Product Model) --> F(MongoDB 資料庫)
    F -- 回傳商品資訊 --> E
    E -- 檢查商品庫存是否足夠 --> G(後端應用程式 - Node.js/Express)
    G -- 庫存不足則回傳錯誤 --> B
    G -- 庫存足夠則建立新訂單 (Order Model) --> F
    F -- 儲存新訂單 --> G
    G -- 回傳 "訂購成功" 訊息 --> B
    B -- 顯示成功訊息 & 更新商品列表 --> A
```

**流程說明：**

1.  **使用者操作 (前端)**：使用者在前端瀏覽商品列表，點擊某商品的「立即訂購」按鈕。
2.  **前端處理 (React)**：前端應用程式會檢查使用者是否已登入，並彈出確認視窗。
3.  **發送 API 請求 (前端)**：如果使用者確認訂購，前端會向後端發送一個 `POST /api/products/order` 請求，請求中包含商品 ID (`productId`) 和使用者的認證 Token (`Authorization` Header)。
4.  **後端接收請求 (Node.js/Express)**：後端應用程式接收到請求。
5.  **認證與授權 (後端)**：後端的中介軟體 (`authMiddleware`) 會驗證請求中的 JWT Token，確認使用者身份和權限。
6.  **查詢商品資訊 (後端 -> 資料庫)**：後端根據 `productId` 從 MongoDB 資料庫中查詢對應的商品資訊。
7.  **回傳商品資訊 (資料庫 -> 後端)**：MongoDB 將查詢到的商品資訊回傳給後端。
8.  **檢查庫存 (後端)**：後端檢查商品的剩餘庫存是否足夠進行訂購。
9.  **庫存不足處理 (後端 -> 前端)**：如果庫存不足，後端會回傳錯誤訊息給前端，前端顯示「商品已售罄」等提示。
10. **建立新訂單 (後端 -> 資料庫)**：如果庫存足夠，後端會根據使用者 ID、商品 ID、商品名稱、價格等資訊，建立一個新的訂單記錄，並將其儲存到 MongoDB 資料庫中。
11. **儲存新訂單 (資料庫 -> 後端)**：MongoDB 成功儲存訂單後，回傳確認訊息給後端。
12. **回傳成功訊息 (後端 -> 前端)**：後端回傳「訂購成功」的訊息給前端。
13. **更新前端介面 (前端)**：前端接收到成功訊息後，顯示訂購成功的提示，並更新商品列表（例如減少商品庫存顯示）。